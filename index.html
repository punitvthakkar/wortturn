<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERMAN NEURAL NETWORK - Cyber Academy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff88;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 136, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Floating particles */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, #00ff88, transparent),
                radial-gradient(2px 2px at 40px 70px, #ff0080, transparent),
                radial-gradient(1px 1px at 90px 40px, #00ffff, transparent);
            background-repeat: repeat;
            background-size: 150px 150px;
            animation: sparkle 3s linear infinite;
            pointer-events: none;
            z-index: 1;
            opacity: 0.4;
        }

        @keyframes sparkle {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .title {
            font-size: clamp(24px, 6vw, 48px);
            font-weight: 900;
            color: #00ff88;
            text-shadow: 
                0 0 10px #00ff88,
                0 0 20px #00ff88,
                0 0 40px #00ff88;
            margin-bottom: 15px;
            animation: titleGlow 2s ease-in-out infinite alternate;
            letter-spacing: 3px;
        }

        @keyframes titleGlow {
            from { 
                text-shadow: 
                    0 0 10px #00ff88,
                    0 0 20px #00ff88,
                    0 0 40px #00ff88;
            }
            to { 
                text-shadow: 
                    0 0 15px #00ff88,
                    0 0 30px #00ff88,
                    0 0 60px #00ff88,
                    0 0 80px #00ff88;
            }
        }

        .subtitle {
            font-size: clamp(12px, 3vw, 18px);
            color: #ff6b9d;
            text-shadow: 0 0 15px #ff6b9d;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Cyber Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .tab-btn {
            background: linear-gradient(45deg, #1a1a2e, #2d2d5a);
            border: 2px solid #00ff88;
            color: #00ff88;
            padding: 18px 30px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: clamp(10px, 2.5vw, 14px);
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            clip-path: polygon(10px 0%, 100% 0%, calc(100% - 10px) 100%, 0% 100%);
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,136,0.3), transparent);
            transition: left 0.6s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
            box-shadow: 
                0 0 20px #00ff88,
                inset 0 0 20px rgba(0,255,136,0.3);
            transform: translateY(-3px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cyber Game Arena */
        .game-arena {
            background: 
                linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(45, 45, 90, 0.95)),
                radial-gradient(circle at center, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
            border: 3px solid #00ff88;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: 
                0 0 40px rgba(0, 255, 136, 0.3),
                inset 0 0 40px rgba(0, 255, 136, 0.1);
        }

        .game-arena::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ff88, #ff6b9d, #00ffff, #00ff88);
            border-radius: 20px;
            z-index: -1;
            animation: borderPulse 3s linear infinite;
        }

        @keyframes borderPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* HUD Display */
        .hud {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .score-hud, .time-hud, .progress-hud {
            background: linear-gradient(45deg, rgba(0, 0, 0, 0.8), rgba(26, 26, 46, 0.8));
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 15px 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .score-hud::before, .time-hud::before, .progress-hud::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,136,0.2), transparent);
            animation: hudScan 2s linear infinite;
        }

        @keyframes hudScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .hud-label {
            font-size: 10px;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hud-value {
            font-size: clamp(16px, 4vw, 24px);
            font-weight: 900;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }

        .time-hud .hud-value {
            color: #ff6b9d;
            text-shadow: 0 0 10px #ff6b9d;
        }

        .time-hud.warning .hud-value {
            color: #ff4757;
            text-shadow: 0 0 15px #ff4757;
            animation: timePulse 0.5s ease-in-out infinite;
        }

        @keyframes timePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Cyber Lifelines */
        .cyber-lifelines {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .lifeline-btn {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border: 2px solid #00ffff;
            color: #00ffff;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .lifeline-btn::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: conic-gradient(from 0deg, #00ffff, #ff6b9d, #00ff88, #00ffff);
            border-radius: 50%;
            z-index: -1;
            animation: rotateBorder 3s linear infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .lifeline-btn:hover::before {
            opacity: 1;
        }

        @keyframes rotateBorder {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .lifeline-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 0 30px #00ffff;
        }

        .lifeline-btn:disabled {
            background: #333;
            border-color: #666;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .lifeline-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .lifeline-text {
            font-size: 8px;
            line-height: 1;
        }

        /* Neural Question Chamber */
        .question-chamber {
            background: 
                linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(26, 26, 46, 0.9)),
                radial-gradient(circle at center, rgba(0, 255, 136, 0.1) 0%, transparent 60%);
            border: 3px solid #ff6b9d;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .question-chamber::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 157, 0.3), transparent);
            animation: questionScan 4s linear infinite;
        }

        @keyframes questionScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .question-text {
            font-size: clamp(16px, 4vw, 22px);
            line-height: 1.6;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            position: relative;
            z-index: 2;
        }

        /* Cyber Answer Grid */
        .answer-matrix {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        .answer-pod {
            background: linear-gradient(135deg, #1a1a2e, #2d2d5a);
            border: 3px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-height: 100px;
            display: flex;
            align-items: center;
        }

        .answer-pod::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,136,0.3), transparent);
            transition: left 0.6s;
        }

        .answer-pod:hover:not(.disabled)::before {
            left: 100%;
        }

        .answer-letter {
            background: linear-gradient(45deg, #ff6b9d, #ff8fab);
            color: #000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 20px;
            margin-right: 20px;
            flex-shrink: 0;
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.5);
        }

        .answer-text {
            flex: 1;
            font-size: clamp(14px, 3.5vw, 18px);
            line-height: 1.4;
            font-weight: 600;
        }

        .answer-pod:hover:not(.disabled) {
            transform: translateX(15px) scale(1.03);
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .answer-pod:hover:not(.disabled) .answer-letter {
            background: linear-gradient(45deg, #00ffff, #66d9e8);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
        }

        .answer-pod.correct {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #fff;
            animation: correctPulse 1s ease-in-out;
        }

        .answer-pod.wrong {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #fff;
            animation: wrongShake 0.6s ease-in-out;
        }

        .answer-pod.eliminated {
            background: #333;
            border-color: #666;
            opacity: 0.3;
            cursor: not-allowed;
        }

        .answer-pod.disabled {
            cursor: not-allowed;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px); }
            75% { transform: translateX(15px); }
        }

        /* Control Matrix */
        .control-matrix {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .cyber-btn {
            background: linear-gradient(45deg, #ff6b9d, #ff8fab);
            border: 3px solid #fff;
            color: #000;
            padding: 18px 35px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: clamp(12px, 3vw, 16px);
            font-weight: 900;
            border-radius: 10px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .cyber-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .cyber-btn:hover::before {
            left: 100%;
        }

        .cyber-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(255, 107, 157, 0.4);
        }

        .cyber-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Corrections Archive */
        .corrections-archive, .history-vault, .analytics-lab {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(45, 45, 90, 0.95));
            border: 3px solid #00ff88;
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .archive-title, .vault-title, .lab-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: clamp(18px, 4vw, 28px);
            color: #00ff88;
            font-weight: 900;
            text-shadow: 0 0 15px #00ff88;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .correction-entry {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #ff6b9d;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s;
        }

        .correction-entry:hover {
            border-color: #00ffff;
            transform: translateX(10px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .correction-question {
            font-size: 16px;
            color: #fff;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .correction-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            font-size: 14px;
        }

        .your-answer {
            color: #ff4757;
            font-weight: 600;
        }

        .correct-answer {
            color: #2ed573;
            font-weight: 600;
        }

        /* Modals */
        .cyber-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            animation: modalFadeIn 0.3s ease-out;
        }

        .modal-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e, #2d2d5a);
            border: 4px solid #00ff88;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            animation: modalSlideIn 0.4s ease-out;
        }

        .modal-title {
            font-size: clamp(18px, 4vw, 24px);
            color: #00ff88;
            margin-bottom: 25px;
            font-weight: 900;
            text-shadow: 0 0 15px #00ff88;
            text-transform: uppercase;
        }

        .modal-content {
            font-size: clamp(14px, 3vw, 18px);
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .answer-matrix {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .hud {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .cyber-lifelines {
                gap: 15px;
            }
            
            .lifeline-btn {
                width: 70px;
                height: 70px;
            }

            .correction-details {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .answer-pod {
                padding: 20px;
                min-height: 80px;
            }

            .answer-letter {
                width: 40px;
                height: 40px;
                font-size: 16px;
                margin-right: 15px;
            }
        }

        /* Stats and Charts */
        .stats-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-pod {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #ff6b9d;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-pod::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 157, 0.2), transparent);
            animation: statScan 3s linear infinite;
        }

        @keyframes statScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stat-pod:hover {
            transform: translateY(-8px);
            border-color: #00ffff;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
        }

        .stat-value {
            font-size: clamp(24px, 6vw, 36px);
            color: #00ff88;
            margin-bottom: 10px;
            font-weight: 900;
            text-shadow: 0 0 15px #00ff88;
        }

        .stat-label {
            font-size: clamp(10px, 2.5vw, 14px);
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .chart-core {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #00ff88;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #888;
            font-size: clamp(12px, 3vw, 16px);
            line-height: 1.6;
            font-weight: 600;
        }

        /* Loading and Special Effects */
        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid #333;
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Question transition animations */
        .question-fade-out {
            animation: fadeOut 0.5s ease-in-out;
        }

        .question-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">GERMAN NEURAL NETWORK</h1>
            <p class="subtitle">Cyber Academy - Matrix Protocol Activated</p>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('game')">NEURAL CORE</button>
            <button class="tab-btn" onclick="switchTab('corrections')">ERROR LOG</button>
            <button class="tab-btn" onclick="switchTab('history')">DATA VAULT</button>
            <button class="tab-btn" onclick="switchTab('dashboard')">ANALYTICS</button>
        </div>

        <!-- Neural Core Game -->
        <div id="game" class="tab-content active">
            <div class="game-arena">
                <div class="hud">
                    <div class="score-hud">
                        <div class="hud-label">Neural Score</div>
                        <div class="hud-value" id="current-score">0</div>
                    </div>
                    <div class="time-hud" id="time-display">
                        <div class="hud-label">Time Matrix</div>
                        <div class="hud-value" id="time-remaining">100</div>
                    </div>
                    <div class="progress-hud">
                        <div class="hud-label">Questions Processed</div>
                        <div class="hud-value" id="questions-answered">0</div>
                    </div>
                </div>
                
                <div class="cyber-lifelines">
                    <button class="lifeline-btn" id="fifty-fifty" onclick="useFiftyFifty()" title="Neural Filter">
                        <div class="lifeline-icon">‚ö°</div>
                        <div class="lifeline-text">Filter</div>
                    </button>
                    <button class="lifeline-btn" id="phone-friend" onclick="usePhoneFriend()" title="Hacker Contact">
                        <div class="lifeline-icon">üì°</div>
                        <div class="lifeline-text">Contact</div>
                    </button>
                    <button class="lifeline-btn" id="ask-audience" onclick="useAskAudience()" title="Network Poll">
                        <div class="lifeline-icon">üåê</div>
                        <div class="lifeline-text">Poll</div>
                    </button>
                    <button class="lifeline-btn" id="ask-expert" onclick="useAskExpert()" title="AI Oracle">
                        <div class="lifeline-icon">ü§ñ</div>
                        <div class="lifeline-text">Oracle</div>
                    </button>
                </div>
                
                <div class="question-chamber">
                    <div class="question-text" id="question-text">
                        Welcome to the German Neural Network!<br>
                        Initialize matrix protocol to begin your linguistic upload...
                    </div>
                </div>
                
                <div class="answer-matrix" id="options-container">
                    <!-- Options will be populated by JavaScript -->
                </div>
                
                <div class="control-matrix">
                    <button class="cyber-btn" id="start-btn" onclick="startGame()">INITIALIZE MATRIX</button>
                    <button class="cyber-btn" id="quit-btn" onclick="quitGame()" style="display:none;">ABORT MISSION</button>
                </div>
            </div>
        </div>

        <!-- Error Log (Corrections) -->
        <div id="corrections" class="tab-content">
            <div class="corrections-archive">
                <h2 class="archive-title">Neural Error Archive</h2>
                <div id="corrections-container">
                    <!-- Corrections will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Data Vault (History) -->
        <div id="history" class="tab-content">
            <div class="history-vault">
                <h2 class="vault-title">Mission Data Vault</h2>
                <div id="history-container">
                    <!-- History will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Analytics Lab (Dashboard) -->
        <div id="dashboard" class="tab-content">
            <div class="analytics-lab">
                <h2 class="lab-title">Neural Analytics Laboratory</h2>
                <div class="stats-matrix">
                    <div class="stat-pod">
                        <div class="stat-value" id="total-games">0</div>
                        <div class="stat-label">Total Missions</div>
                    </div>
                    <div class="stat-pod">
                        <div class="stat-value" id="avg-score">0</div>
                        <div class="stat-label">Avg Neural Score</div>
                    </div>
                    <div class="stat-pod">
                        <div class="stat-value" id="best-score">0</div>
                        <div class="stat-label">Peak Performance</div>
                    </div>
                    <div class="stat-pod">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">Accuracy Matrix</div>
                    </div>
                </div>
                <div class="chart-core">
                    <canvas id="performance-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Cyber Modals -->
    <div id="lifeline-modal" class="cyber-modal">
        <div class="modal-core">
            <h2 class="modal-title" id="lifeline-title">Neural Assist</h2>
            <div class="modal-content" id="lifeline-text"></div>
            <div class="control-matrix">
                <button class="cyber-btn" onclick="closeLifelineModal()">ACKNOWLEDGED</button>
            </div>
        </div>
    </div>

    <div id="game-over-modal" class="cyber-modal">
        <div class="modal-core">
            <h2 class="modal-title">MISSION COMPLETE</h2>
            <div class="modal-content">
                <div style="font-size: clamp(16px, 4vw, 20px); color: #ff6b9d; margin-bottom: 20px;">
                    Neural Score: <span id="final-score">0</span>
                </div>
                <div style="margin-bottom: 15px;">Questions Processed: <span id="questions-processed">0</span></div>
                <div style="margin-bottom: 15px;">Accuracy Rate: <span id="final-accuracy">0%</span></div>
                <div>Mission Duration: <span id="mission-duration">0</span>s</div>
            </div>
            <div class="control-matrix">
                <button class="cyber-btn" onclick="closeGameOverModal()">ACKNOWLEDGED</button>
                <button class="cyber-btn" onclick="startNewGame()">RESTART MATRIX</button>
            </div>
        </div>
    </div>

    <script>
        // Cyber Game State
        let gameData = null;
        let neuralSession = {
            questions: [],
            usedQuestions: new Set(),
            currentQuestion: null,
            questionsAnswered: 0,
            score: 0,
            answers: [],
            corrections: [],
            startTime: null,
            endTime: null,
            timeRemaining: 100,
            gameActive: false,
            difficulty: 1,
            questionTypes: ['article', 'plural', 'translation', 'synonym', 'antonym'],
            currentTypeIndex: 0,
            lifelines: {
                fiftyFifty: true,
                phoneFriend: true,
                askAudience: true,
                askExpert: true
            }
        };

        // Cyber Timer
        let gameTimer = null;

        // Initialize Neural Network
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Initializing Neural Network...');
            await loadNeuralData();
            loadCorrections();
            loadMissionHistory();
            updateAnalytics();
        });

        // Load Neural Data
        async function loadNeuralData() {
            try {
                console.log('Loading neural vocabulary matrix...');
                const response = await fetch('list.json');
                
                if (!response.ok) {
                    throw new Error(`Neural link error: ${response.status}`);
                }
                
                const text = await response.text();
                gameData = JSON.parse(text);
                console.log('Neural matrix loaded successfully');
                
                if (!gameData.core_vocabulary_A1_B1) {
                    throw new Error('Invalid neural structure detected');
                }
                
            } catch (error) {
                console.error('Neural data corruption:', error);
                alert('Neural matrix corrupted. Initializing backup protocols...');
                gameData = createBackupMatrix();
            }
        }

        // Backup Neural Matrix
        function createBackupMatrix() {
            return {
                core_vocabulary_A1_B1: {
                    A1: {
                        nomen: [
                            {
                                wort: "Haus",
                                artikel: "das",
                                plural: "die H√§user",
                                bedeutung_en: "house",
                                synonyme_de: ["Geb√§ude"],
                                antonyme_de: []
                            },
                            {
                                wort: "Auto",
                                artikel: "das", 
                                plural: "die Autos",
                                bedeutung_en: "car",
                                synonyme_de: ["Wagen"],
                                antonyme_de: []
                            },
                            {
                                wort: "Freund",
                                artikel: "der",
                                plural: "die Freunde",
                                bedeutung_en: "friend",
                                synonyme_de: ["Kamerad"],
                                antonyme_de: ["Feind"]
                            }
                        ],
                        verben: [
                            {
                                infinitiv: "sein",
                                praeteritum: "war",
                                partizip_ii: "gewesen",
                                bedeutung_en: "to be",
                                synonyme_de: [],
                                antonyme_de: []
                            },
                            {
                                infinitiv: "haben",
                                praeteritum: "hatte",
                                partizip_ii: "gehabt",
                                bedeutung_en: "to have",
                                synonyme_de: [],
                                antonyme_de: []
                            }
                        ],
                        adjektive_adverbien: [
                            {
                                wort: "gut",
                                bedeutung_en: "good",
                                synonyme_de: ["sch√∂n"],
                                antonyme_de: ["schlecht"]
                            },
                            {
                                wort: "gro√ü",
                                bedeutung_en: "big",
                                synonyme_de: ["riesig"],
                                antonyme_de: ["klein"]
                            }
                        ]
                    }
                }
            };
        }

        // Tab Navigation
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                updateAnalytics();
            } else if (tabName === 'history') {
                loadMissionHistory();
            } else if (tabName === 'corrections') {
                loadCorrections();
            }
        }

        // Enhanced Question Generation
        function generateNeuralQuestion(forceType = null) {
            if (!gameData || !gameData.core_vocabulary_A1_B1) {
                console.error('Neural data unavailable');
                return null;
            }

            // Determine question type (balanced distribution)
            let questionType;
            if (forceType) {
                questionType = forceType;
            } else {
                // Cycle through types for balance
                questionType = neuralSession.questionTypes[neuralSession.currentTypeIndex];
                neuralSession.currentTypeIndex = (neuralSession.currentTypeIndex + 1) % neuralSession.questionTypes.length;
            }
            
            // Determine level based on difficulty
            const levels = ['A1', 'A2', 'B1'];
            const difficultyLevel = Math.min(Math.floor(neuralSession.difficulty), 3);
            const levelWeights = difficultyLevel === 1 ? [0.7, 0.2, 0.1] :
                                difficultyLevel === 2 ? [0.3, 0.5, 0.2] :
                                [0.1, 0.3, 0.6];
            
            const level = selectWeightedRandom(levels, levelWeights);
            
            try {
                let question = null;
                let attempts = 0;
                const maxAttempts = 20;
                
                while (!question && attempts < maxAttempts) {
                    switch (questionType) {
                        case 'article':
                            question = generateArticleQuestion(level);
                            break;
                        case 'plural':
                            question = generatePluralQuestion(level);
                            break;
                        case 'translation':
                            question = generateTranslationQuestion(level);
                            break;
                        case 'synonym':
                            question = generateSynonymQuestion(level);
                            break;
                        case 'antonym':
                            question = generateAntonymQuestion(level);
                            break;
                    }
                    
                    // Check if question was used before
                    if (question) {
                        const questionKey = `${question.type}-${question.word}-${question.question}`;
                        if (neuralSession.usedQuestions.has(questionKey)) {
                            question = null; // Try again
                        } else {
                            neuralSession.usedQuestions.add(questionKey);
                        }
                    }
                    
                    attempts++;
                }
                
                return question || generateFallbackQuestion();
                
            } catch (error) {
                console.error('Neural question generation error:', error);
                return generateFallbackQuestion();
            }
        }

        function generateFallbackQuestion() {
            const fallbacks = [
                {
                    question: "What does 'Hallo' mean in English?",
                    type: 'translation',
                    level: 'A1',
                    correct: "Hello",
                    options: ["Hello", "Goodbye", "Please", "Thank you"],
                    word: "Hallo",
                    explanation: "Hallo = Hello"
                },
                {
                    question: "What is the correct article for 'Haus'?",
                    type: 'article',
                    level: 'A1',
                    correct: "das",
                    options: ["das", "der", "die", "kein Artikel"],
                    word: "Haus",
                    explanation: "das Haus (the house)"
                }
            ];
            
            return fallbacks[Math.floor(Math.random() * fallbacks.length)];
        }

        function selectWeightedRandom(items, weights) {
            const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < items.length; i++) {
                if (random < weights[i]) {
                    return items[i];
                }
                random -= weights[i];
            }
            return items[items.length - 1];
        }

        function getWordsFromLevel(level, category) {
            try {
                const levelData = gameData.core_vocabulary_A1_B1[level];
                if (!levelData) {
                    return gameData.core_vocabulary_A1_B1.A1?.[category] || [];
                }
                return levelData[category] || [];
            } catch (error) {
                console.error(`Error getting words from level ${level}, category ${category}:`, error);
                return [];
            }
        }

        function generateArticleQuestion(level) {
            const nouns = getWordsFromLevel(level, 'nomen');
            if (nouns.length === 0) return null;
            
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            if (!noun.artikel || !noun.wort) return null;
            
            const correctAnswer = noun.artikel;
            // Include "kein Artikel" as requested
            const articles = ['der', 'die', 'das', 'kein Artikel'];
            const wrongAnswers = articles.filter(a => a !== correctAnswer);
            
            return {
                question: `Select the correct article for "${noun.wort}"`,
                type: 'article',
                level: level,
                correct: correctAnswer,
                options: shuffleArray([correctAnswer, ...wrongAnswers.slice(0, 3)]),
                word: noun.wort,
                explanation: `${correctAnswer} ${noun.wort} (${noun.bedeutung_en || 'German word'})`
            };
        }

        function generatePluralQuestion(level) {
            const nouns = getWordsFromLevel(level, 'nomen');
            const validNouns = nouns.filter(n => n.plural && n.plural !== '(kein Plural)' && n.artikel && n.wort);
            if (validNouns.length === 0) return null;
            
            const noun = validNouns[Math.floor(Math.random() * validNouns.length)];
            const correctAnswer = noun.plural;
            
            const wrongAnswers = generateWrongPlurals(noun.wort, correctAnswer);
            
            return {
                question: `What is the plural form of "${noun.artikel} ${noun.wort}"?`,
                type: 'plural',
                level: level,
                correct: correctAnswer,
                options: shuffleArray([correctAnswer, ...wrongAnswers]),
                word: noun.wort,
                explanation: `${noun.artikel} ${noun.wort} ‚Üí ${correctAnswer}`
            };
        }

        function generateTranslationQuestion(level) {
            const categories = ['nomen', 'verben', 'adjektive_adverbien'];
            const category = categories[Math.floor(Math.random() * categories.length)];
            const words = getWordsFromLevel(level, category);
            const validWords = words.filter(w => w.wort && w.bedeutung_en);
            
            if (validWords.length === 0) return null;
            
            const word = validWords[Math.floor(Math.random() * validWords.length)];
            const correctAnswer = word.bedeutung_en;
            
            let wrongAnswers = validWords
                .filter(w => w.bedeutung_en !== correctAnswer)
                .map(w => w.bedeutung_en)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            if (wrongAnswers.length < 3) {
                const genericAnswers = ['to go', 'house', 'good', 'bad', 'big', 'small', 'happy', 'sad'];
                wrongAnswers = [...wrongAnswers, ...genericAnswers]
                    .filter(ans => ans !== correctAnswer)
                    .slice(0, 3);
            }
            
            return {
                question: `What does "${word.wort}" mean in English?`,
                type: 'translation',
                level: level,
                correct: correctAnswer,
                options: shuffleArray([correctAnswer, ...wrongAnswers]),
                word: word.wort,
                explanation: `${word.wort} = ${correctAnswer}`
            };
        }

        function generateSynonymQuestion(level) {
            const categories = ['nomen', 'verben', 'adjektive_adverbien'];
            const category = categories[Math.floor(Math.random() * categories.length)];
            const words = getWordsFromLevel(level, category);
            const wordsWithSynonyms = words.filter(w => w.synonyme_de && w.synonyme_de.length > 0 && w.wort);
            
            if (wordsWithSynonyms.length === 0) return null;
            
            const word = wordsWithSynonyms[Math.floor(Math.random() * wordsWithSynonyms.length)];
            const correctAnswer = word.synonyme_de[0];
            
            const wrongAnswers = words
                .filter(w => w.wort && w.wort !== word.wort && !word.synonyme_de.includes(w.wort))
                .map(w => w.wort)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            return {
                question: `Which word has a similar meaning to "${word.wort}"?`,
                type: 'synonym',
                level: level,
                correct: correctAnswer,
                options: shuffleArray([correctAnswer, ...wrongAnswers]),
                word: word.wort,
                explanation: `${word.wort} ‚âà ${correctAnswer} (similar meaning)`
            };
        }

        function generateAntonymQuestion(level) {
            const categories = ['nomen', 'verben', 'adjektive_adverbien'];
            const category = categories[Math.floor(Math.random() * categories.length)];
            const words = getWordsFromLevel(level, category);
            const wordsWithAntonyms = words.filter(w => w.antonyme_de && w.antonyme_de.length > 0 && w.wort);
            
            if (wordsWithAntonyms.length === 0) return null;
            
            const word = wordsWithAntonyms[Math.floor(Math.random() * wordsWithAntonyms.length)];
            const correctAnswer = word.antonyme_de[0];
            
            const wrongAnswers = words
                .filter(w => w.wort && w.wort !== word.wort && !word.antonyme_de.includes(w.wort))
                .map(w => w.wort)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            return {
                question: `Which word is the opposite of "${word.wort}"?`,
                type: 'antonym',
                level: level,
                correct: correctAnswer,
                options: shuffleArray([correctAnswer, ...wrongAnswers]),
                word: word.wort,
                explanation: `${word.wort} ‚Üî ${correctAnswer} (opposite)`
            };
        }

        function generateWrongPlurals(singular, correctPlural) {
            const endings = ['e', 'en', 'er', 's'];
            const wrongAnswers = [];
            
            endings.forEach(ending => {
                const wrong = `die ${singular}${ending}`;
                if (wrong !== correctPlural && wrongAnswers.length < 3) {
                    wrongAnswers.push(wrong);
                }
            });
            
            if (wrongAnswers.length < 3) {
                wrongAnswers.push(`die ${singular}`, `das ${singular}e`, `der ${singular}en`);
            }
            
            return wrongAnswers.slice(0, 3);
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Game Mechanics
        function startGame() {
            if (!gameData) {
                alert('Neural matrix not ready. Please wait for initialization...');
                return;
            }

            // Reset neural session
            neuralSession = {
                questions: [],
                usedQuestions: new Set(),
                currentQuestion: null,
                questionsAnswered: 0,
                score: 0,
                answers: [],
                corrections: [],
                startTime: new Date().toISOString(),
                timeRemaining: 100,
                gameActive: true,
                difficulty: 1,
                questionTypes: ['article', 'plural', 'translation', 'synonym', 'antonym'],
                currentTypeIndex: 0,
                lifelines: {
                    fiftyFifty: true,
                    phoneFriend: true,
                    askAudience: true,
                    askExpert: true
                }
            };

            // Reset UI
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('quit-btn').style.display = 'inline-block';
            resetLifelines();
            
            // Start timer
            startTimer();
            
            // Load first question
            loadNextQuestion();
        }

        function startTimer() {
            gameTimer = setInterval(() => {
                neuralSession.timeRemaining--;
                document.getElementById('time-remaining').textContent = neuralSession.timeRemaining;
                
                // Warning when time is low
                const timeDisplay = document.getElementById('time-display');
                if (neuralSession.timeRemaining <= 20) {
                    timeDisplay.classList.add('warning');
                } else {
                    timeDisplay.classList.remove('warning');
                }
                
                // End game when time runs out
                if (neuralSession.timeRemaining <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function loadNextQuestion() {
            if (!neuralSession.gameActive) return;
            
            // Generate new question
            const question = generateNeuralQuestion();
            if (!question) {
                console.error('Failed to generate question');
                return;
            }
            
            neuralSession.currentQuestion = question;
            
            // Increase difficulty over time
            neuralSession.difficulty = 1 + (neuralSession.questionsAnswered / 5);
            
            // Animate question transition
            const questionContainer = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            
            // Fade out
            questionContainer.classList.add('question-fade-out');
            optionsContainer.classList.add('question-fade-out');
            
            setTimeout(() => {
                displayQuestion();
                
                // Fade in
                questionContainer.classList.remove('question-fade-out');
                questionContainer.classList.add('question-fade-in');
                optionsContainer.classList.remove('question-fade-out');
                optionsContainer.classList.add('question-fade-in');
                
                setTimeout(() => {
                    questionContainer.classList.remove('question-fade-in');
                    optionsContainer.classList.remove('question-fade-in');
                }, 500);
            }, 250);
        }

        function displayQuestion() {
            const question = neuralSession.currentQuestion;
            if (!question) return;

            document.getElementById('current-score').textContent = neuralSession.score;
            document.getElementById('questions-answered').textContent = neuralSession.questionsAnswered;
            document.getElementById('question-text').textContent = question.question;

            const container = document.getElementById('options-container');
            container.innerHTML = '';

            const letters = ['A', 'B', 'C', 'D'];

            question.options.forEach((option, index) => {
                const pod = document.createElement('div');
                pod.className = 'answer-pod';
                pod.innerHTML = `
                    <div class="answer-letter">${letters[index]}</div>
                    <div class="answer-text">${option}</div>
                `;
                pod.onclick = () => selectAnswer(option, pod);
                pod.dataset.option = option;

                container.appendChild(pod);
            });
        }

        function selectAnswer(selectedAnswer, podElement) {
            if (!neuralSession.gameActive) return;
            
            const question = neuralSession.currentQuestion;
            const isCorrect = selectedAnswer === question.correct;
            
            // Record answer
            const answerRecord = {
                question: question.question,
                selected: selectedAnswer,
                correct: question.correct,
                isCorrect: isCorrect,
                type: question.type,
                level: question.level,
                word: question.word,
                explanation: question.explanation
            };
            
            neuralSession.answers.push(answerRecord);
            
            // Add to corrections if wrong
            if (!isCorrect) {
                neuralSession.corrections.push(answerRecord);
            }

            // Update score
            if (isCorrect) {
                const basePoints = 100;
                const difficultyMultiplier = neuralSession.difficulty;
                const timeBonus = Math.floor(neuralSession.timeRemaining / 10);
                const points = Math.floor(basePoints * difficultyMultiplier + timeBonus);
                neuralSession.score += points;
            }

            neuralSession.questionsAnswered++;

            // Visual feedback
            document.querySelectorAll('.answer-pod').forEach(pod => {
                pod.classList.add('disabled');
                if (pod.dataset.option === question.correct) {
                    pod.classList.add('correct');
                } else if (pod === podElement && !isCorrect) {
                    pod.classList.add('wrong');
                }
            });

            // Auto-advance to next question
            setTimeout(() => {
                if (neuralSession.gameActive) {
                    loadNextQuestion();
                }
            }, 1500);
        }

        function quitGame() {
            if (confirm('Abort neural mission? All progress will be lost.')) {
                endGame();
            }
        }

        function endGame() {
            neuralSession.gameActive = false;
            neuralSession.endTime = new Date().toISOString();
            
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            
            // Save game data
            saveMissionData();
            
            // Show game over modal
            showGameOverModal();
            
            // Reset game state
            resetGameState();
        }

        function showGameOverModal() {
            const accuracy = neuralSession.questionsAnswered > 0 ? 
                Math.round((neuralSession.answers.filter(a => a.isCorrect).length / neuralSession.questionsAnswered) * 100) : 0;
            const duration = neuralSession.startTime ? 
                Math.round((new Date(neuralSession.endTime) - new Date(neuralSession.startTime)) / 1000) : 0;
            
            document.getElementById('final-score').textContent = neuralSession.score;
            document.getElementById('questions-processed').textContent = neuralSession.questionsAnswered;
            document.getElementById('final-accuracy').textContent = accuracy + '%';
            document.getElementById('mission-duration').textContent = duration;
            
            document.getElementById('game-over-modal').style.display = 'block';
        }

        function closeGameOverModal() {
            document.getElementById('game-over-modal').style.display = 'none';
        }

        function startNewGame() {
            closeGameOverModal();
            startGame();
        }

        function resetGameState() {
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('quit-btn').style.display = 'none';
            document.getElementById('question-text').innerHTML = 'Welcome to the German Neural Network!<br>Initialize matrix protocol to begin your linguistic upload...';
            document.getElementById('options-container').innerHTML = '';
            document.getElementById('current-score').textContent = '0';
            document.getElementById('questions-answered').textContent = '0';
            document.getElementById('time-remaining').textContent = '100';
            document.getElementById('time-display').classList.remove('warning');
            
            resetLifelines();
        }

        // Lifeline functions
        function resetLifelines() {
            ['fifty-fifty', 'phone-friend', 'ask-audience', 'ask-expert'].forEach(id => {
                const btn = document.getElementById(id);
                btn.disabled = false;
                btn.classList.remove('used');
            });
        }

        function useFiftyFifty() {
            if (!neuralSession.lifelines.fiftyFifty || !neuralSession.gameActive) return;
            
            neuralSession.lifelines.fiftyFifty = false;
            document.getElementById('fifty-fifty').disabled = true;
            
            const question = neuralSession.currentQuestion;
            const correctAnswer = question.correct;
            
            const answerPods = Array.from(document.querySelectorAll('.answer-pod'));
            const wrongPods = answerPods.filter(pod => pod.dataset.option !== correctAnswer);
            
            const toEliminate = wrongPods.sort(() => 0.5 - Math.random()).slice(0, 2);
            toEliminate.forEach(pod => {
                pod.classList.add('eliminated');
                pod.onclick = null;
            });
            
            showLifelineModal('Neural Filter Activated', 'Two incorrect data nodes have been eliminated from the matrix.');
        }

        function usePhoneFriend() {
            if (!neuralSession.lifelines.phoneFriend || !neuralSession.gameActive) return;
            
            neuralSession.lifelines.phoneFriend = false;
            document.getElementById('phone-friend').disabled = true;
            
            const question = neuralSession.currentQuestion;
            const letters = ['A', 'B', 'C', 'D'];
            const correctIndex = question.options.indexOf(question.correct);
            const correctLetter = letters[correctIndex];
            
            const isRight = Math.random() < 0.80;
            const suggestion = isRight ? correctLetter : letters[Math.floor(Math.random() * 4)];
            const confidence = isRight ? 
                Math.floor(Math.random() * 25) + 75 : 
                Math.floor(Math.random() * 40) + 40;
                
            showLifelineModal(
                'Hacker Contact Established',
                `Neural link established with linguistic expert.\n\n"Based on my database analysis, I'm ${confidence}% confident the answer is ${suggestion}. The pattern matches known German syntax protocols."`
            );
        }

        function useAskAudience() {
            if (!neuralSession.lifelines.askAudience || !neuralSession.gameActive) return;
            
            neuralSession.lifelines.askAudience = false;
            document.getElementById('ask-audience').disabled = true;
            
            const question = neuralSession.currentQuestion;
            const letters = ['A', 'B', 'C', 'D'];
            const correctIndex = question.options.indexOf(question.correct);
            
            const votes = [0, 0, 0, 0];
            let remaining = 100;
            
            votes[correctIndex] = Math.floor(Math.random() * 35) + 40;
            remaining -= votes[correctIndex];
            
            for (let i = 0; i < 4; i++) {
                if (i !== correctIndex && remaining > 0) {
                    const vote = Math.floor(Math.random() * (remaining / 2));
                    votes[i] = vote;
                    remaining -= vote;
                }
            }
            votes[0] += remaining;
            
            const pollResults = letters.map((letter, index) => 
                `${letter}: ${votes[index]}%`
            ).join('\n');
            
            showLifelineModal(
                'Network Poll Results',
                `Global neural network polled 1,000 German language AIs:\n\n${pollResults}\n\nCollective intelligence analysis complete.`
            );
        }

        function useAskExpert() {
            if (!neuralSession.lifelines.askExpert || !neuralSession.gameActive) return;
            
            neuralSession.lifelines.askExpert = false;
            document.getElementById('ask-expert').disabled = true;
            
            const question = neuralSession.currentQuestion;
            const letters = ['A', 'B', 'C', 'D'];
            const correctIndex = question.options.indexOf(question.correct);
            const correctLetter = letters[correctIndex];
            
            const isRight = Math.random() < 0.95;
            const suggestion = isRight ? correctLetter : letters[Math.floor(Math.random() * 4)];
            
            const expertAdvice = isRight ?
                `AI Oracle Analysis Complete:\n\n"Neural pattern recognition indicates ${suggestion} with 95% certainty. ${question.explanation || 'This matches established linguistic protocols.'}"` :
                `AI Oracle Analysis:\n\n"Processing... I detect ${suggestion} as the most probable solution, though the data contains some anomalies."`;
            
            showLifelineModal('AI Oracle Consulted', expertAdvice);
        }

        function showLifelineModal(title, text) {
            document.getElementById('lifeline-title').textContent = title;
            document.getElementById('lifeline-text').textContent = text;
            document.getElementById('lifeline-modal').style.display = 'block';
        }

        function closeLifelineModal() {
            document.getElementById('lifeline-modal').style.display = 'none';
        }

        // Data Management
        function saveMissionData() {
            const missions = JSON.parse(localStorage.getItem('neuralMissions') || '[]');
            const missionRecord = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                score: neuralSession.score,
                questionsAnswered: neuralSession.questionsAnswered,
                correctAnswers: neuralSession.answers.filter(a => a.isCorrect).length,
                accuracy: Math.round((neuralSession.answers.filter(a => a.isCorrect).length / neuralSession.questionsAnswered) * 100),
                duration: calculateMissionDuration(),
                answers: neuralSession.answers,
                corrections: neuralSession.corrections,
                lifelinesUsed: Object.entries(neuralSession.lifelines).filter(([key, value]) => !value).length
            };
            
            missions.unshift(missionRecord);
            if (missions.length > 50) {
                missions.splice(50);
            }
            
            localStorage.setItem('neuralMissions', JSON.stringify(missions));
            
            // Also save corrections separately
            const allCorrections = JSON.parse(localStorage.getItem('neuralCorrections') || '[]');
            allCorrections.unshift(...neuralSession.corrections);
            if (allCorrections.length > 200) {
                allCorrections.splice(200);
            }
            localStorage.setItem('neuralCorrections', JSON.stringify(allCorrections));
        }

        function calculateMissionDuration() {
            if (!neuralSession.startTime || !neuralSession.endTime) return 0;
            const start = new Date(neuralSession.startTime);
            const end = new Date(neuralSession.endTime);
            return Math.round((end - start) / 1000);
        }

        function loadCorrections() {
            const corrections = JSON.parse(localStorage.getItem('neuralCorrections') || '[]');
            const container = document.getElementById('corrections-container');
            
            if (corrections.length === 0) {
                container.innerHTML = '<div class="empty-state">Neural error archive is empty.<br>Complete some missions to build your learning database!</div>';
                return;
            }
            
            container.innerHTML = '';
            
            corrections.slice(0, 50).forEach(correction => {
                const entry = document.createElement('div');
                entry.className = 'correction-entry';
                entry.innerHTML = `
                    <div class="correction-question">${correction.question}</div>
                    <div class="correction-details">
                        <div class="your-answer">Your Answer: ${correction.selected}</div>
                        <div class="correct-answer">Correct Answer: ${correction.correct}</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #888;">
                        ${correction.explanation}
                    </div>
                `;
                container.appendChild(entry);
            });
        }

        function loadMissionHistory() {
            const missions = JSON.parse(localStorage.getItem('neuralMissions') || '[]');
            const container = document.getElementById('history-container');
            
            if (missions.length === 0) {
                container.innerHTML = '<div class="empty-state">Mission data vault is empty.<br>Complete your first neural mission to begin building your legacy!</div>';
                return;
            }
            
            container.innerHTML = '';
            
            missions.forEach(mission => {
                const item = document.createElement('div');
                item.className = 'correction-entry';
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="color: #00ff88; font-weight: 700;">${mission.date} ${mission.time}</div>
                            <div style="font-size: 12px; color: #888; margin-top: 3px;">
                                ${mission.questionsAnswered} questions ‚Ä¢ ${mission.lifelinesUsed || 0} assists used
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #ff6b9d; font-weight: 700; font-size: 18px;">${mission.score}</div>
                            <div style="font-size: 12px; color: #888; margin-top: 3px;">
                                ${mission.accuracy}% accuracy
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #aaa;">
                        Mission Duration: ${mission.duration}s ‚Ä¢ Corrections Generated: ${mission.corrections?.length || 0}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateAnalytics() {
            const missions = JSON.parse(localStorage.getItem('neuralMissions') || '[]');
            
            if (missions.length === 0) {
                document.getElementById('total-games').textContent = '0';
                document.getElementById('avg-score').textContent = '0';
                document.getElementById('best-score').textContent = '0';
                document.getElementById('accuracy').textContent = '0%';
                updatePerformanceChart([]);
                return;
            }
            
            const totalMissions = missions.length;
            const avgScore = Math.round(missions.reduce((sum, mission) => sum + mission.score, 0) / totalMissions);
            const bestScore = Math.max(...missions.map(mission => mission.score));
            const totalCorrect = missions.reduce((sum, mission) => sum + mission.correctAnswers, 0);
            const totalQuestions = missions.reduce((sum, mission) => sum + mission.questionsAnswered, 0);
            const overallAccuracy = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            
            document.getElementById('total-games').textContent = totalMissions;
            document.getElementById('avg-score').textContent = avgScore;
            document.getElementById('best-score').textContent = bestScore;
            document.getElementById('accuracy').textContent = overallAccuracy + '%';
            
            updatePerformanceChart(missions);
        }

        function updatePerformanceChart(missions) {
            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            if (window.performanceChart) {
                window.performanceChart.destroy();
            }
            
            if (missions.length === 0) {
                ctx.fillStyle = '#666';
                ctx.font = '16px "Orbitron"';
                ctx.textAlign = 'center';
                ctx.fillText('No neural missions completed', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            const recentMissions = missions.slice(0, 15).reverse();
            const labels = recentMissions.map((_, index) => `Mission ${index + 1}`);
            const scores = recentMissions.map(mission => mission.score);
            const accuracies = recentMissions.map(mission => mission.accuracy);
            
            window.performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Neural Score',
                            data: scores,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            tension: 0.4,
                            borderWidth: 3,
                            pointBackgroundColor: '#00ff88',
                            pointBorderColor: '#000',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Accuracy %',
                            data: accuracies,
                            borderColor: '#ff6b9d',
                            backgroundColor: 'rgba(255, 107, 157, 0.1)',
                            tension: 0.4,
                            borderWidth: 3,
                            pointBackgroundColor: '#ff6b9d',
                            pointBorderColor: '#000',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff',
                                font: { family: 'Orbitron', size: 12 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: '#fff', 
                                font: { family: 'Orbitron', size: 10 } 
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Neural Score',
                                color: '#00ff88',
                                font: { family: 'Orbitron', size: 12 }
                            },
                            ticks: { 
                                color: '#00ff88', 
                                font: { family: 'Orbitron', size: 10 } 
                            },
                            grid: { color: 'rgba(0, 255, 136, 0.1)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Accuracy %',
                                color: '#ff6b9d',
                                font: { family: 'Orbitron', size: 12 }
                            },
                            ticks: { 
                                color: '#ff6b9d', 
                                font: { family: 'Orbitron', size: 10 } 
                            },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
